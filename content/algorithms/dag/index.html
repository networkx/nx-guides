
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Directed Acyclic Graphs &amp; Topological Sort &#8212; NetworkX Notebooks</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Graph Generators" href="../../generators/index.html" />
    <link rel="prev" title="Node assortativity coefficients and correlation measures" href="../assortativity/correlation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/networkx_logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NetworkX Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Algorithms
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../assortativity/correlation.html">
     Node assortativity coefficients and correlation measures
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Directed Acyclic Graphs &amp; Topological Sort
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../generators/index.html">
   Graph Generators
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../generators/geometric.html">
     Geometric Generator Models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../exploratory_notebooks/facebook_notebook.html">
   Facebook Network Analysis
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../../_sources/content/algorithms/dag/index.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/algorithms/dag/index.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/networkx/nx-guides/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/networkx/nx-guides//issues/new?title=Issue%20on%20page%20%2Fcontent/algorithms/dag/index.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/networkx/nx-guides/edit/main/site/content/algorithms/dag/index.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/networkx/nx-guides/main?urlpath=tree/site/content/algorithms/dag/index.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#directed-graph">
   Directed Graph
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition">
     Definition
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#directed-acyclic-graph">
   Directed Acyclic Graph
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applications">
     Applications
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Definition
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#topological-sort">
   Topological sort
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Applications
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kahn-s-algorithm">
     Kahn’s algorithm
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#networkx-implementation">
     NetworkX implementation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-1-initialize-indegrees">
       Step 1. Initialize indegrees.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-2-initialize-first-level">
       Step 2. Initialize first level.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-3-move-from-one-level-to-the-next">
       Step 3. Move from one level to the next.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#step-4-check-if-there-is-a-cycle-in-the-graph">
       Step 4. Check if there is a cycle in the graph.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addendum-topological-sort-works-on-multigraphs-as-well">
       Addendum: Topological sort works on multigraphs as well.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#addendum-the-graph-may-have-changed-during-the-iteration">
       Addendum: The graph may have changed during the iteration.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#combine-all-steps">
       Combine all steps.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="directed-acyclic-graphs-topological-sort">
<h1>Directed Acyclic Graphs &amp; Topological Sort<a class="headerlink" href="#directed-acyclic-graphs-topological-sort" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will explore the algorithms related to a directed acyclic graph
(or a “dag” as it is sometimes called) implemented in networkx under <code class="docutils literal notranslate"><span class="pre">networkx/algorithms/dag.py</span></code>.</p>
<p>First of all, we need to understand what a directed graph is.</p>
<div class="section" id="directed-graph">
<h2>Directed Graph<a class="headerlink" href="#directed-graph" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">triangle_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_edgelist</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="o">.</span><span class="n">draw_planar</span><span class="p">(</span><span class="n">triangle_graph</span><span class="p">,</span>
    <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">node_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;#ffff8f&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_3_0.png" src="../../../_images/index_3_0.png" />
</div>
</div>
</div>
<div class="section" id="definition">
<h3>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h3>
<p>In mathematics, and more specifically in graph theory,
a directed graph (or DiGraph) is a graph that is made up of a set of vertices
connected by directed edges often called arcs.
Edges here have <em>directionality</em>, which stands in contrast to undirected graphs
where, semantically, edges have no notion of a direction to them.
Directed acyclic graphs take this idea further;
by being <em>acyclic</em>, they have no <em>cycles</em> in them.
You will see this idea in action in the examples below.</p>
</div>
</div>
<div class="section" id="directed-acyclic-graph">
<h2>Directed Acyclic Graph<a class="headerlink" href="#directed-acyclic-graph" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clothing_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_graphml</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data/clothing_graph.graphml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_planar</span><span class="p">(</span><span class="n">clothing_graph</span><span class="p">,</span>
    <span class="n">arrowsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">node_size</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span>
    <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;#ffff8f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_6_0.png" src="../../../_images/index_6_0.png" />
</div>
</div>
<p>Here is a fun example of Professor Bumstead,
who has a routine for getting dressed in the morning.
By habit, the professor dons certain garments before others (e.g., socks before shoes).
Other items may be put on in any order (e.g., socks and pants).</p>
<p>A directed edge <span class="math notranslate nohighlight">\((u, v)\)</span> in the example indicates that garment <span class="math notranslate nohighlight">\(u\)</span>
must be donned before garment <span class="math notranslate nohighlight">\(v\)</span>.</p>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">clothing_graph</span></code> is a DAG.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="o">.</span><span class="n">is_directed_acyclic_graph</span><span class="p">(</span><span class="n">clothing_graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>By contrast, the <code class="docutils literal notranslate"><span class="pre">triangle_graph</span></code> is not a DAG.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="o">.</span><span class="n">is_directed_acyclic_graph</span><span class="p">(</span><span class="n">triangle_graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>This is because the <code class="docutils literal notranslate"><span class="pre">triangle_graph</span></code> has a cycle:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="o">.</span><span class="n">find_cycle</span><span class="p">(</span><span class="n">triangle_graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(1, 2), (2, 3), (3, 1)]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="applications">
<h3>Applications<a class="headerlink" href="#applications" title="Permalink to this headline">¶</a></h3>
<p>Directed acyclic graphs representations of partial orderings have many applications in scheduling
of systems of tasks with ordering constraints.
An important class of problems of this type concern collections of objects that need to be updated,
for example, calculating the order of cells of a spreadsheet to update after one of the cells has been changed,
or identifying which object files of software to update after its source code has been changed.
In these contexts, we use a dependency graph, which is a graph that has a vertex for each object to be updated,
and an edge connecting two objects whenever one of them needs to be updated earlier than the other.
A cycle in this graph is called a circular dependency, and is generally not allowed,
because there would be no way to consistently schedule the tasks involved in the cycle.
Dependency graphs without circular dependencies form DAGs.</p>
<p>A directed acyclic graph may also be used to represent a network of processing elements.
In this representation, data enters a processing element through its incoming edges
and leaves the element through its outgoing edges.
For instance, in electronic circuit design, static combinational logic blocks
can be represented as an acyclic system of logic gates that computes a function of an input,
where the input and output of the function are represented as individual bits.</p>
</div>
<div class="section" id="id2">
<h3>Definition<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>A directed acyclic graph (“DAG” or “dag”) is a directed graph with no directed cycles.
That is, it consists of vertices and edges (also called arcs), with each edge directed from one vertex to another,
such that following those directions will never form a closed loop.</p>
<p>A directed graph is a DAG if and only if it can be topologically ordered
by arranging the vertices as a linear ordering that is consistent with all edge directions.</p>
</div>
</div>
<div class="section" id="topological-sort">
<h2>Topological sort<a class="headerlink" href="#topological-sort" title="Permalink to this headline">¶</a></h2>
<p>Let’s now introduce what the topological sort is.</p>
<div class="section" id="id3">
<h3>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">(</span><span class="n">clothing_graph</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;undershorts&#39;,
 &#39;shirt&#39;,
 &#39;socks&#39;,
 &#39;watch&#39;,
 &#39;pants&#39;,
 &#39;tie&#39;,
 &#39;belt&#39;,
 &#39;shoes&#39;,
 &#39;jacket&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Applications<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The canonical application of topological sorting is in scheduling a sequence of jobs
or tasks based on their dependencies.
The jobs are represented by vertices, and there is an edge from <span class="math notranslate nohighlight">\(u\)</span> to <span class="math notranslate nohighlight">\(v\)</span>
if job <span class="math notranslate nohighlight">\(u\)</span> must be completed before job <span class="math notranslate nohighlight">\(v\)</span> can be started
(for example, when washing clothes, the washing machine must finish before we put the clothes in the dryer).
Then, a topological sort gives an order in which to perform the jobs.</p>
<p>A closely related application of topological sorting algorithms
was first studied in the early 1960s in the context of the
<a class="reference external" href="https://en.wikipedia.org/wiki/Program_evaluation_and_review_technique">PERT technique</a>
for scheduling in project management.
In this application, the vertices of a graph represent the milestones of a project,
and the edges represent tasks that must be performed between one milestone and another.
Topological sorting forms the basis of linear-time algorithms for finding
the critical path of the project, a sequence of milestones and tasks that controls
the length of the overall project schedule.</p>
<p>In computer science, applications of this type arise in instruction scheduling,
ordering of formula cell evaluation when recomputing formula values in spreadsheets,
logic synthesis, determining the order of compilation tasks to perform in makefiles,
data serialization, and resolving symbol dependencies in linkers.
It is also used to decide in which order to load tables with foreign keys in databases.</p>
</div>
<div class="section" id="id5">
<h3>Definition<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>A topological sort of a directed acyclic graph <span class="math notranslate nohighlight">\(G = (V, E)\)</span> is a linear ordering of all its vertices
such that if <span class="math notranslate nohighlight">\(G\)</span> contains an edge <span class="math notranslate nohighlight">\((u, v)\)</span>, then <span class="math notranslate nohighlight">\(u\)</span> appears before <span class="math notranslate nohighlight">\(v\)</span> in the ordering.</p>
<p>It is worth noting that if the graph contains a cycle, then no linear ordering is possible.</p>
<p>It is useful to view a topological sort of a graph as an ordering of its vertices
along a horizontal line so that all directed edges go from left to right.</p>
</div>
<div class="section" id="kahn-s-algorithm">
<h3>Kahn’s algorithm<a class="headerlink" href="#kahn-s-algorithm" title="Permalink to this headline">¶</a></h3>
<p>NetworkX uses Kahn’s algorithm to perform topological sorting.
We will introduce it briefly here.</p>
<p>First, find a list of “start nodes” which have no incoming edges and insert them into a set S;
at least one such node must exist in a non-empty acyclic graph. Then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">&lt;-</span> <span class="n">Empty</span> <span class="nb">list</span> <span class="n">that</span> <span class="n">will</span> <span class="n">contain</span> <span class="n">the</span> <span class="nb">sorted</span> <span class="n">elements</span>
<span class="n">S</span> <span class="o">&lt;-</span> <span class="n">Set</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">nodes</span> <span class="k">with</span> <span class="n">no</span> <span class="n">incoming</span> <span class="n">edge</span>

<span class="k">while</span> <span class="n">S</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">empty</span> <span class="n">do</span>
    <span class="n">remove</span> <span class="n">a</span> <span class="n">node</span> <span class="n">N</span> <span class="kn">from</span> <span class="nn">S</span>
    <span class="n">add</span> <span class="n">N</span> <span class="n">to</span> <span class="n">L</span>
    <span class="k">for</span> <span class="n">each</span> <span class="n">node</span> <span class="n">M</span> <span class="k">with</span> <span class="n">an</span> <span class="n">edge</span> <span class="n">E</span> <span class="kn">from</span> <span class="nn">N</span> <span class="n">to</span> <span class="n">M</span> <span class="n">do</span>
        <span class="n">remove</span> <span class="n">edge</span> <span class="n">E</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">graph</span>
        <span class="k">if</span> <span class="n">M</span> <span class="n">has</span> <span class="n">no</span> <span class="n">other</span> <span class="n">incoming</span> <span class="n">edges</span> <span class="n">then</span>
            <span class="n">insert</span> <span class="n">M</span> <span class="n">into</span> <span class="n">S</span>

<span class="k">if</span> <span class="n">graph</span> <span class="n">has</span> <span class="n">edges</span> <span class="n">then</span>
    <span class="k">return</span> <span class="n">error</span>  <span class="c1"># graph has at least one cycle</span>
<span class="k">else</span> 
    <span class="k">return</span> <span class="n">L</span>  <span class="c1"># a topologically sorted order</span>
</pre></div>
</div>
</div>
<div class="section" id="networkx-implementation">
<h3>NetworkX implementation<a class="headerlink" href="#networkx-implementation" title="Permalink to this headline">¶</a></h3>
<p>Finally, let’s take a look at how the topological sorting is implemented in NetworkX.</p>
<p>We can see that Kahn’s algorithm <em>stratifies</em> the graph such that each level contains all the nodes
whose dependencies have been satisfied by the nodes in a previous level.
In other words, Kahn’s algorithm does something like:</p>
<ul class="simple">
<li><p>Take all the nodes in the DAG that don’t have any dependencies and put them in list.</p></li>
<li><p>“Remove” those nodes from the DAG.</p></li>
<li><p>Repeat the process, creating a new list at each step.
Thus, topological sorting is reduced to correctly stratifying the graph in this way.</p></li>
</ul>
<p>This procedure is implemented in the <code class="docutils literal notranslate"><span class="pre">topological_generations()</span></code> function, on which the <code class="docutils literal notranslate"><span class="pre">topological_sort()</span></code> function is based.</p>
<p>Let’s see how the <code class="docutils literal notranslate"><span class="pre">topological_generations()</span></code> function is implemented in NetworkX step by step.</p>
<div class="section" id="step-1-initialize-indegrees">
<h4>Step 1. Initialize indegrees.<a class="headerlink" href="#step-1-initialize-indegrees" title="Permalink to this headline">¶</a></h4>
<p>Since in Kahn’s algorithm we are only interested in the indegrees of the vertices,
in order to preserve the structure of the graph as it is passed in,
instead of removing the edges, we will decrease the indegree of the corresponding vertex.
Therefore, we will save these values in a separate <em>dictionary</em> <code class="docutils literal notranslate"><span class="pre">indegree_map</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indegree_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">d</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">in_degree</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-initialize-first-level">
<h4>Step 2. Initialize first level.<a class="headerlink" href="#step-2-initialize-first-level" title="Permalink to this headline">¶</a></h4>
<p>At each step of Kahn’s algorithm, we seek out vertices with an in-degree of zero.
In preparation for the first loop iteration of the algorithm,
we can initialize a list called <code class="docutils literal notranslate"><span class="pre">zero_indegree</span></code> that houses these nodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zero_indegree</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">in_degree</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-move-from-one-level-to-the-next">
<h4>Step 3. Move from one level to the next.<a class="headerlink" href="#step-3-move-from-one-level-to-the-next" title="Permalink to this headline">¶</a></h4>
<p>Now, we will show how the algorithm moves from one level to the next.</p>
<p>Inside the loop, the first generation to be considered (<code class="docutils literal notranslate"><span class="pre">this_generation</span></code>)
is the collection of nodes that have zero in-degrees.</p>
<p>We process all the vertices of the current level in variable <code class="docutils literal notranslate"><span class="pre">this_generation</span></code>
and we store the next level in variable <code class="docutils literal notranslate"><span class="pre">zero_degree</span></code>.</p>
<p>For each vertex inside <code class="docutils literal notranslate"><span class="pre">this_generation</span></code>,
we remove all of its outgoing edges.</p>
<p>Then, if the input degree of some vertex is zeroed as a result,
then we add it to the next level <code class="docutils literal notranslate"><span class="pre">zero_indegree</span></code>
and remove it from the <code class="docutils literal notranslate"><span class="pre">indegree_map</span></code> dictionary.</p>
<p>After we have processed all of the nodes inside <code class="docutils literal notranslate"><span class="pre">this_generation</span></code>, we can yield it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">zero_indegree</span><span class="p">:</span>
    <span class="n">this_generation</span> <span class="o">=</span> <span class="n">zero_indegree</span>
    <span class="n">zero_indegree</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">this_generation</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zero_indegree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span>

    <span class="k">yield</span> <span class="n">this_generation</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-check-if-there-is-a-cycle-in-the-graph">
<h4>Step 4. Check if there is a cycle in the graph.<a class="headerlink" href="#step-4-check-if-there-is-a-cycle-in-the-graph" title="Permalink to this headline">¶</a></h4>
<p>If, after completing the loop there are still vertices in the graph,
then there is a cycle in it and the graph is not a DAG.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">indegree_map</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXUnfeasible</span><span class="p">(</span>
        <span class="s2">&quot;Graph contains a cycle or graph changed during iteration&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="addendum-topological-sort-works-on-multigraphs-as-well">
<h4>Addendum: Topological sort works on multigraphs as well.<a class="headerlink" href="#addendum-topological-sort-works-on-multigraphs-as-well" title="Permalink to this headline">¶</a></h4>
<p>This is possible to do by slightly modifying the algorithm above.</p>
<ul>
<li><p>Firstly, check if <code class="docutils literal notranslate"><span class="pre">G</span></code> is a multigraph</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multigraph</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">is_multigraph</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Then, replace</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">child</span><span class="p">])</span> <span class="k">if</span> <span class="n">multigraph</span> <span class="k">else</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="addendum-the-graph-may-have-changed-during-the-iteration">
<h4>Addendum: The graph may have changed during the iteration.<a class="headerlink" href="#addendum-the-graph-may-have-changed-during-the-iteration" title="Permalink to this headline">¶</a></h4>
<p>Between passing different levels in a topological sort, the graph could change.
We need to check this while the <code class="docutils literal notranslate"><span class="pre">while</span></code> loop is running.</p>
<ul>
<li><p>To do this, just replace</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">this_generation</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">this_generation</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Graph changed during iteration&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">indegree_map</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Graph changed during iteration&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="combine-all-steps">
<h4>Combine all steps.<a class="headerlink" href="#combine-all-steps" title="Permalink to this headline">¶</a></h4>
<p>Combining all of the above gives the current implementation of the <code class="docutils literal notranslate"><span class="pre">topological_generations()</span></code> function in NetworkX.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>

<span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">topological_generations</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>def topological_generations(G):
    &quot;&quot;&quot;Stratifies a DAG into generations.

    A topological generation is node collection in which ancestors of a node in each
    generation are guaranteed to be in a previous generation, and any descendants of
    a node are guaranteed to be in a following generation. Nodes are guaranteed to
    be in the earliest possible generation that they can belong to.

    Parameters
    ----------
    G : NetworkX digraph
        A directed acyclic graph (DAG)

    Yields
    ------
    sets of nodes
        Yields sets of nodes representing each generation.

    Raises
    ------
    NetworkXError
        Generations are defined for directed graphs only. If the graph
        `G` is undirected, a :exc:`NetworkXError` is raised.

    NetworkXUnfeasible
        If `G` is not a directed acyclic graph (DAG) no topological generations
        exist and a :exc:`NetworkXUnfeasible` exception is raised.  This can also
        be raised if `G` is changed while the returned iterator is being processed

    RuntimeError
        If `G` is changed while the returned iterator is being processed.

    Examples
    --------
    &gt;&gt;&gt; DG = nx.DiGraph([(2, 1), (3, 1)])
    &gt;&gt;&gt; [sorted(generation) for generation in nx.topological_generations(DG)]
    [[2, 3], [1]]

    Notes
    -----
    The generation in which a node resides can also be determined by taking the
    max-path-distance from the node to the farthest leaf node. That value can
    be obtained with this function using `enumerate(topological_generations(G))`.

    See also
    --------
    topological_sort
    &quot;&quot;&quot;
    if not G.is_directed():
        raise nx.NetworkXError(&quot;Topological sort not defined on undirected graphs.&quot;)

    multigraph = G.is_multigraph()
    indegree_map = {v: d for v, d in G.in_degree() if d &gt; 0}
    zero_indegree = [v for v, d in G.in_degree() if d == 0]

    while zero_indegree:
        this_generation = zero_indegree
        zero_indegree = []
        for node in this_generation:
            if node not in G:
                raise RuntimeError(&quot;Graph changed during iteration&quot;)
            for child in G.neighbors(node):
                try:
                    indegree_map[child] -= len(G[node][child]) if multigraph else 1
                except KeyError as err:
                    raise RuntimeError(&quot;Graph changed during iteration&quot;) from err
                if indegree_map[child] == 0:
                    zero_indegree.append(child)
                    del indegree_map[child]
        yield this_generation

    if indegree_map:
        raise nx.NetworkXUnfeasible(
            &quot;Graph contains a cycle or graph changed during iteration&quot;
        )
</pre></div>
</div>
</div>
</div>
<p>Let’s finally see what the result will be on the <code class="docutils literal notranslate"><span class="pre">clothing_graph</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">topological_generations</span><span class="p">(</span><span class="n">clothing_graph</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[&#39;undershorts&#39;, &#39;shirt&#39;, &#39;socks&#39;, &#39;watch&#39;],
 [&#39;pants&#39;, &#39;tie&#39;],
 [&#39;belt&#39;, &#39;shoes&#39;],
 [&#39;jacket&#39;]]
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../assortativity/correlation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Node assortativity coefficients and correlation measures</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../generators/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Graph Generators</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By NetworkX developers<br/>
        
            &copy; Copyright 2021, NetworkX developers.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>